<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<title>Chatran پویا 🤖</title>
<style>
body{background:#0f172a;color:#e2e8f0;font-family:sans-serif;margin:0;display:flex;justify-content:center;align-items:center;height:100vh;}
#chat-container{width:400px;height:600px;background:#1e293b;border-radius:12px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 0 10px #06b6d4;}
#chatbox{flex-grow:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column;}
.msg{margin:5px 0;padding:8px 12px;border-radius:12px;max-width:70%;word-wrap:break-word;}
.user{background:#06b6d4;color:#000;align-self:flex-end;text-align:right;}
.bot{background:#334155;color:#e2e8f0;align-self:flex-start;text-align:left;}
#input-area{display:flex;padding:5px;background:#0f172a;}
#msg{flex-grow:1;padding:8px;border-radius:6px;border:none;outline:none;background:#1e293b;color:white;}
button{background:#06b6d4;border:none;color:black;border-radius:6px;margin-left:5px;padding:8px 12px;cursor:pointer;}
button:hover{background:#22d3ee;}
</style>
</head>
<body>
<div id="chat-container">
  <div id="chatbox"></div>
  <div id="input-area">
    <input id="msg" placeholder="پیام خود را بنویسید..." autocomplete="off">
    <button onclick="send()">ارسال</button>
  </div>
</div>

<script>
// حافظه مدل
let model = JSON.parse(localStorage.getItem("chatran_model") || "[]");
let lastPrompt = null;
const blacklist=["گاییدم","کسکش","کیر","کص","کونی","کیرم","پوفک","fuck","shit","bitch","asshole","idiot","dumb"];

// افزودن پیام به صفحه
function addMessage(text,sender){
  const div=document.createElement("div");
  div.className="msg "+sender;
  div.innerText=text;
  document.getElementById("chatbox").appendChild(div);
  div.scrollIntoView({behavior:"smooth"});
}

// تولید پاسخ
function generateText(prompt){
  const lower = prompt.toLowerCase();
  // جواب ثابت
  if(lower.includes("سازنده تو کی هست") || lower.includes("تو رو کی ساخته")) return "Chatran";

  let words = prompt.split(/\s+/).slice(-2);
  let candidates = model.filter(m => m[0]===words[0] && m[1]===words[1]);
  if(candidates.length===0){
    lastPrompt = words;
    return "می‌تونی بیشتر توضیح بدی؟";
  }
  return candidates[Math.floor(Math.random()*candidates.length)][2];
}

// یادگیری پویا و تایید
function learn(input){
  if(!lastPrompt) return false;
  const triple = [lastPrompt[0], lastPrompt[1], input];
  if(triple.some(w=>blacklist.includes(w.toLowerCase()))) return false;
  const exists = model.some(m=>m[0]===triple[0] && m[1]===triple[1] && m[2]===triple[2]);
  if(!exists){
    model.push(triple);
    localStorage.setItem("chatran_model",JSON.stringify(model));
    lastPrompt = null;
    addMessage("یاد گرفتم، مرسی!","bot");
    return true;
  }
  lastPrompt = null;
  return false;
}

// ارسال پیام
function send(){
  const input = document.getElementById("msg");
  const text = input.value.trim();
  if(!text) return;
  addMessage(text,"user");
  input.value="";

  // یادگیری
  if(learn(text)) return;

  setTimeout(()=>{
    const reply = generateText(text);
    addMessage(reply,"bot");
  },200);
}

// ارسال با Enter
document.getElementById("msg").addEventListener("keydown",function(e){
  if(e.key==="Enter") send();
});
</script>
</body>
</html>
