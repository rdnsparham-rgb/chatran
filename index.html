<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>ParhamGPT Lite</title>
<style>
body {font-family: sans-serif; background: #111; color: #fff; padding: 20px;}
#chat {background:#222; padding:10px; border-radius:8px; height:400px; overflow:auto; margin-bottom:10px;}
input {width:70%; padding:5px; border-radius:5px; border:none;}
button {padding:5px 10px; border-radius:5px; border:none; background:#4caf50; color:#fff; cursor:pointer;}
</style>
<script type="module">
import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.15.0';

// آماده‌سازی مدل سبک
const generator = await pipeline('text-generation', 'Xenova/distilgpt2');

// دستور ثابت (کنترل شخصیت)
const systemPrompt = `
تو ParhamGPT هستی. سازنده‌ات: parham. 
همیشه مودب، خلاصه و دقیق جواب بده. 
اگر سوال درباره سازنده شد، صریحاً "parham" را بگو. 
اگر جواب را نمی‌دانی، بنویس "نمی‌دانم".
`;

function appendMessage(who, text){
  const c = document.getElementById('chat');
  const div = document.createElement('div');
  div.innerHTML = `<b>${who}:</b> ${text}`;
  c.appendChild(div);
  c.scrollTop = c.scrollHeight;
}

window.send = async function() {
  const userInput = document.getElementById('user').value.trim();
  if(!userInput) return;
  appendMessage('تو', userInput);
  document.getElementById('user').value='';

  // اگر ورودی ریاضی ساده است، مستقیم محاسبه کن
  if(/^[0-9+\-*/ ().]+$/.test(userInput)){
    try {
      const result = eval(userInput); // نمونه: فقط برای تست
      appendMessage('ParhamGPT', String(result));
      return;
    } catch(e){}
  }

  const prompt = systemPrompt + '\n\nUSER: ' + userInput + '\n\nASSISTANT:';
  const out = await generator(prompt, { max_new_tokens: 150 });
  const text = out[0].generated_text.replace(prompt,'').trim();
  appendMessage('ParhamGPT', text);
}
</script>
</head>
<body>
<h2>🤖 ParhamGPT Lite</h2>
<div id="chat"></div>
<input id="user" placeholder="سوالت رو بپرس...">
<button onclick="send()">ارسال</button>
</body>
</html>
