<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<title>Chatran Ø´Ø¨ÛŒÙ‡ ChatGPT ðŸ¤–</title>
<style>
body{
  background:#0f172a;
  color:#e2e8f0;
  font-family:sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}
#chat-container{
  width:400px;
  background:#1e293b;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  box-shadow:0 0 10px #06b6d4;
}
#chatbox{
  flex-grow:1;
  padding:10px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  max-height:500px;
}
.msg{
  margin:5px 0;
  padding:8px 12px;
  border-radius:12px;
  word-wrap:break-word;
  max-width:70%;
}
.user{
  background:#06b6d4;
  color:#000;
  align-self:flex-end;
  text-align:right;
}
.bot{
  background:#334155;
  color:#e2e8f0;
  align-self:flex-start;
  text-align:left;
}
#input-area{
  display:flex;
  padding:5px;
  background:#0f172a;
}
input{
  flex-grow:1;
  padding:8px;
  border-radius:6px;
  border:none;
  outline:none;
  background:#1e293b;
  color:white;
}
button{
  background:#06b6d4;
  border:none;
  color:black;
  border-radius:6px;
  margin-left:5px;
  padding:8px 12px;
  cursor:pointer;
}
button:hover{background:#22d3ee;}
</style>
</head>
<body>
<div id="chat-container">
  <div id="chatbox"></div>
  <div id="input-area">
    <input id="msg" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." autocomplete="off">
    <button onclick="send()">Ø§Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<script>
// Ù…Ø¯Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± localStorage
let model = JSON.parse(localStorage.getItem("chatran_model") || "[]");
let waitingForUserLearning=null;
const blacklist=["Ú¯Ø§ÛŒÛŒØ¯Ù…","Ú©Ø³Ú©Ø´","Ú©ÛŒØ±","Ú©Øµ","Ú©ÙˆÙ†ÛŒ","Ú©ÛŒØ±Ù…","Ù¾ÙˆÙÚ©","fuck","shit","bitch","asshole","idiot","dumb"];

// Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ù‡ ØµÙØ­Ù‡
function addMessage(text,sender){
  const div=document.createElement("div");
  div.className="msg "+sender;
  div.innerText=text;
  document.getElementById("chatbox").appendChild(div);
  div.scrollIntoView({behavior:"smooth"});
}

// ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®
function generateText(prompt){
  let words = prompt.split(/\s+/);
  let lastTwo = words.slice(-2);
  let candidates = model.filter(m=>m[0]===lastTwo[0] && m[1]===lastTwo[1]);
  if(candidates.length===0){
    waitingForUserLearning=lastTwo;
    return "Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨ÛŒØ´ØªØ± ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯ÛŒØŸ";
  }
  let next = candidates[Math.floor(Math.random()*candidates.length)][2];
  return next;
}

// Ø°Ø®ÛŒØ±Ù‡ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ
function learnFromUser(input){
  if(!waitingForUserLearning) return;
  const triple=[waitingForUserLearning[0],waitingForUserLearning[1],input];
  if(triple.some(w=>blacklist.includes(w.toLowerCase()))) return;
  const exists=model.some(m=>m[0]===triple[0] && m[1]===triple[1] && m[2]===triple[2]);
  if(!exists) model.push(triple);
  localStorage.setItem("chatran_model",JSON.stringify(model));
  waitingForUserLearning=null;
}

function send(){
  const input=document.getElementById("msg");
  const text=input.value.trim();
  if(!text) return;
  addMessage(text,"user");
  input.value="";

  // ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¬Ù…Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ú¯Ø± Ù„Ø§Ø²Ù… Ø¨ÙˆØ¯
  learnFromUser(text);

  setTimeout(()=>{
    const reply=generateText(text);
    addMessage(reply,"bot");
  },200);
}

// Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ Enter
document.getElementById("msg").addEventListener("keydown",function(e){
  if(e.key==="Enter") send();
});
</script>
</body>
</html>
